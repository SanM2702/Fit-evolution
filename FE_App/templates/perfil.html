{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - Fit Evolution</title>
    <link rel="icon" type="image/png" href="{% static 'images/logopng.png' %}">
    <link rel="stylesheet" href="{% static 'css/perfil.css' %}">
</head>
<body>
    <div class="profile-container">
        <!-- Botones de navegación -->
        <div class="navigation-buttons">
            <a href="{% url 'dashboard' %}" class="back-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Menu
            </a>
            {% if plan %}
                <a href="{% url 'ver_plan_entrenamiento' plan.id %}" class="nav-btn nav-btn-training">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                    </svg>
                    Mi Entrenamiento
                </a>
            {% else %}
                <button class="nav-btn nav-btn-training" disabled title="Aún no tienes un plan de entrenamiento">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                    </svg>
                    Mi Entrenamiento
                </button>
            {% endif %}
            <a href="{% url 'nutricion' %}" class="nav-btn nav-btn-nutrition">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3z"/>
                </svg>
                Nutrición
            </a>
            <button class="nav-btn nav-btn-cardio" disabled>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                </svg>
                Cardio
            </button>
        </div>

        <div class="profile-view-card">
            <!-- Header con foto de perfil -->
            <div class="profile-view-header">
                <div class="profile-photo-section">
                    {% if profile.foto_perfil %}
                        <img src="{{ profile.foto_perfil.url }}" alt="Foto de perfil" class="profile-photo">
                    {% else %}
                        <div class="profile-photo-placeholder">
                            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                    {% endif %}
                </div>
                <div class="profile-user-info">
                    <h1>{{ user.get_full_name|default:user.username }}</h1>
                    <p class="user-email">{{ user.email }}</p>
                    <p class="profile-date">Perfil creado: {{ profile.fecha_creacion|date:"d/m/Y" }}</p>
                </div>
                <div class="header-logo">
                    <img src="{% static 'images/logo.svg' %}" alt="Fit Evolution Logo" class="logo-img">
                </div>
            </div>

            <!-- Mensajes -->
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Botón de editar -->
            <div class="profile-actions">
                <a href="{% url 'editar_perfil' %}" class="btn btn-primary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Editar Perfil
                </a>
            </div>

            <!-- Datos del perfil -->
            <div class="profile-data">
                <!-- Sección: Datos Personales -->
                <div class="data-section">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Datos Personales
                    </h2>
                    <div class="data-grid">
                        <div class="data-item">
                            <span class="data-label">Edad</span>
                            <span class="data-value">{{ profile.edad }} años</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Sexo</span>
                            <span class="data-value">{{ profile.get_sexo_display }}</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Peso</span>
                            <span class="data-value">{{ profile.peso }} kg</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Altura</span>
                            <span class="data-value">{{ profile.altura }} cm</span>
                        </div>
                        <div class="data-item highlight">
                            <span class="data-label">IMC</span>
                            <span class="data-value">{{ profile.imc|floatformat:2 }}</span>
                        </div>
                    </div>
                </div>

                <!-- Sección: Datos de Entrenamiento -->
                <div class="data-section">
                    <h2 class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                        Datos de Entrenamiento
                    </h2>
                    <div class="data-grid">
                        <div class="data-item">
                            <span class="data-label">Nivel de Actividad</span>
                            <span class="data-value badge badge-{{ profile.nivel_actividad }}">
                                {{ profile.get_nivel_actividad_display }}
                            </span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Objetivo</span>
                            <span class="data-value badge badge-objetivo">
                                {{ profile.get_objetivo_display }}
                            </span>
                        </div>
                        <div class="data-item highlight" id="grasa-container">
                            <span class="data-label">Porcentaje de Grasa</span>
                            <span class="data-value" id="grasa-percentage">{{ profile.porcentaje_grasa }}%</span>
                            <div class="grasa-info" id="grasa-info"></div>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Tiempo de Entrenamiento</span>
                            <span class="data-value">{{ profile.tiempo_entrenamiento }} minutos</span>
                        </div>
                    </div>
                </div>

                <!-- Información adicional -->
                <div class="profile-footer">
                    <p class="last-update">Última actualización: {{ profile.fecha_actualizacion|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Animación de entrada
        document.addEventListener('DOMContentLoaded', function() {
            const card = document.querySelector('.profile-view-card');
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);

            // Animar items de datos
            const dataItems = document.querySelectorAll('.data-item');
            dataItems.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateX(-20px)';
                
                setTimeout(() => {
                    item.style.transition = 'all 0.4s ease';
                    item.style.opacity = '1';
                    item.style.transform = 'translateX(0)';
                }, 200 + (index * 50));
            });

            // Sistema de evaluación de porcentaje de grasa
            function evaluarPorcentajeGrasa() {
                const grasaElement = document.getElementById('grasa-percentage');
                const grasaInfoElement = document.getElementById('grasa-info');
                
                if (!grasaElement || !grasaInfoElement) return;
                
                // Extraer el valor numérico del porcentaje
                const grasaText = grasaElement.textContent;
                const grasaValue = parseFloat(grasaText.replace('%', ''));
                
                let colorClass = '';
                let icon = '';
                let mensaje = '';
                
                // Determinar color, icono y mensaje según el porcentaje
                if (grasaValue >= 1 && grasaValue <= 4) {
                    colorClass = 'grasa-critico';
                    icon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>';
                    mensaje = 'Riesgo de fallo orgánico o anorexia';
                } else if (grasaValue > 4 && grasaValue <= 6) {
                    colorClass = 'grasa-minimo';
                    icon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>';
                    mensaje = 'Nivel mínimo vital';
                } else if (grasaValue > 6 && grasaValue <= 13) {
                    colorClass = 'grasa-muy-bajo';
                    icon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>';
                    mensaje = 'Muy bajo, recomendable solo en deportistas de élite';
                } else if (grasaValue > 13 && grasaValue <= 17) {
                    colorClass = 'grasa-ideal';
                    icon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>';
                    mensaje = 'Ideal para buena condición física y salud';
                } else if (grasaValue > 17 && grasaValue <= 24) {
                    colorClass = 'grasa-promedio';
                    icon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-6 0v4"/><rect x="2" y="9" width="20" height="11" rx="2" ry="2"/></svg>';
                    mensaje = 'Porcentaje de grasa promedio, sin riesgos';
                } else if (grasaValue > 24 && grasaValue <= 31) {
                    colorClass = 'grasa-riesgo';
                    icon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>';
                    mensaje = 'Aumento de riesgo cardiovascular y metabólico';
                } else if (grasaValue > 31) {
                    colorClass = 'grasa-alto-riesgo';
                    icon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>';
                    mensaje = 'Alto riesgo de enfermedades cardiovasculares, diabetes y otras ';
                } else {
                    colorClass = 'grasa-sin-datos';
                    icon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>';
                    mensaje = 'Valor no válido';
                }
                
                // Aplicar el color al porcentaje
                grasaElement.className = `data-value ${colorClass}`;
                
                // Mostrar el mensaje con icono
                grasaInfoElement.innerHTML = `
                    <span class="grasa-icon ${colorClass}">${icon}</span>
                    <span class="grasa-mensaje ${colorClass}">${mensaje}</span>
                `;
                grasaInfoElement.style.display = 'flex';
            }
            
            // Ejecutar la evaluación cuando se carga la página
            evaluarPorcentajeGrasa();
        });
    </script>
</body>
</html>
